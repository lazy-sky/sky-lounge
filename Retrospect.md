(초기 작성중, 2022-06-05)

# 회고

### 프로젝트 선정 이유

토이 프로젝트지만 사용자가 직접 가입해서 사용할 수 있는 서비스를 만들고 싶었다. 왜냐하면 여태 짧은 기간 공부하면서 만들어 본 것들은 전부 그저 베타 버전으로 만들어지고 거기에 그칠 뿐이었기 때문이다. 실사용이 있는 서비스라면 그것을 운영하고 디버깅하는 등 지속적인 개발 경험을 이어나갈 수 있으리라 생각했기 때문이다. 주변 지인 중심으로라도 홍보해서 사용자를 유치시키면 어쨌거나 사용자 경험이 쌓이게 되고 이를 바탕으로 서비스를 개선해나가고 싶다.

## 문제상황과 해결 및 배운 것들

### 컴포넌트 분리

컴포넌트를 어떻게 나눌 것인가는 참 어려우면서도 항상 명확한 답이 없는 문제다. 여태까지는 확장성을 중요 고려 가치로 여기면서 큰 그림을 미리 그리고 작업을 진행했는데 이번엔 과도하게 확장성을 고려하는 대신 대략적인 기획 초안 안에서 그때 그때 필요한 것들을 만들고 사용 범위에 따라 선언 위치를 올려나가고, 컴포넌트를 분리하는 식으로 진행했다. 각 방식에는 장단점이 있다. 물론 초기 기획이 깔끔한 게 가장 좋겠지만 기획, 디자인 등은 항상 변하기 마련이니 나중에 리팩토링에 방해가 되지 않는 선에서 너무 과하게 미래를 생각하는 방식은 지양하는 게 맞는 것 같다.

### 데어티 페칭과 UI 분리

처음엔 react query를 이용하여 컴포넌트 안에서 최대한 데이터 로딩 상태 등 페칭과 관련된 것들을 분리하려고 했다. 그런데 firebase 문서를 살펴보다 보니 snapshot을 이용한 데이터 구독 관련 함수들이 있는 걸 발견했다. 해당 api가 간편하게 실시간 데이터 페칭을 지원하고 있어 react query를 패키지에서 제거하고 firebase api 만으로 데이터 로직을 구성하게 되었다.

### Firebase 무료 플랜 한도 초과

처음 게시글 피드를 만들었을 땐 요청마다 게시글 전체를 가져오는 로직으로 작성했다. 물론 지금은(그리고 아마 앞으로도 ㅠ) 게시글의 수가 많지 않기 때문에 오히려 한 번에 불러오는 게 더 효과적이다. 하지만 게시글의 매우 많은 널리 사용되는 서비스라고 가정하면 이러한 요청 방식은 큰 무리가 있다. 따라서 게시글 데이터 페칭에 페이지네이션, 무한 스크롤, 레이지 로딩 등을 적용하려 했다. 

그런데 변경 도중 실수로 무한 요청을 보내게 되어 로컬 서버를 종료하기 전까지 불과 수 초만에 무료 플랜의 read 요청 한도(일일 5만 회)를 초과시켜버렸다. 과제 마감 기한이 이틀도 안남은 시점에서 파이어베이스 사용을 멈춘 다거나 다른 방식을 시도하기엔 무리가 있어 어쩔 수 없이 유료 플랜을 가입하게 되었다. 큰 돈이 청구되진 않겠지만 상당히 당황스러웠다. 다만 안타깝지만 일단은 계획했던 수정 작업은 미룰 수밖에 없게 되었다. 새삼 요청은 조심해서 해야 한다는 교훈을 얻고 간다. 물론 백엔드 개발자와 협업 시에는 비정상적인 요청이 방지되도록 처리해놨을테지만.

### 린트 에러

`Do not pass children as props. Instead, nest children between the opening and closing tags.`

공통으로 사용할 컴포넌트(페이지의 헤더)를 만들어 `children`(어떤 페이지에선 뒤로 가기 버튼이나 제출 버튼이 있으면 좋겠다고 생각했다.)을 `props`로 받게 했는데 다음과 같은 린트 에러가 발생했다. 에러 메세지가 자체적으로 해결법을 알려주고 있어서 에러를 제거하는 데 어려움은 없었지만 한 가지 의문점이 남았다. 왜 children을 직접 받지 말라는 걸까?  해당 에러만 아니면,
`<Component children={<KidComponent />} />` 라고 적는 것이 굳이 태그를 열었다 닫을 필요가 없어 더 팬시하고 좋아보인다고 생각했다.

아마도 위 방법이 뭔가 잠재적인 위험을 갖고 있어서 일텐데, 그게 뭔지 가늠할 수 없었다. [린트 규칙 문서](https://github.com/jsx-eslint/eslint-plugin-react/blob/master/docs/rules/no-children-prop.md)에서는 `Children should always be actual children, not passed in as a prop.`  라고 적혀있는데, 추론하자면 `children` `props`를 이용하는 방식이 actual하지 않다는 정보일 뿐이다. 대체 actual하지 않다는 게 무엇일까.

잠정적인 결론은 하위 컴포넌트로 전달하는 방식이 `children`을 전달하는 데 있어서 더 의미론적으로 와닿는 방식이라는 것이다. [도움을 얻은 링크]( https://www.netlify.com/blog/2020/12/17/react-children-the-misunderstood-prop/)에서도 무엇이 더 나은 방법이라는 언급 없이 두 방법의 결과가 완전히 동일하다고 언급하고 있다.

여전히 개인적으론 태그를 굳이 열었다 닫는 게 코드도 길어지게 하고 `children`을 이용해서 전달하는 게 의미론적으로 부적합하다는 것에 공감할 수 없다. 다만 결과가 똑같다면 꽤 많은 사람들이 `children`을 쓰지 않고 열었다 닫는 게 의미론적으로든 뭐든 더 좋다고 생각하나 추론할 뿐이다. 한편 린트가 좋은 점 중에 하나는 그 에러 메세지를 잘 들여다보면 뭐가 좋은 건지 고민시키는 데 있는 거 같다고 느꼈다. 어쨌거나 기라성같은 선배 개발자들이 쌓아 놓은 좋은 컨벤션의 집합이니까 설령 다른 결론을 내릴지언정 고민하는 그 자체에 가치가 있다.

### 게시글 수정

게시글 수정을 어떤 식으로 구현해야하는지 처음엔 감이 잘 잡히지 않았다. 게시글 생성과 달리 단순히 데이터를 담아 요청을 create 요청을 보내는 게 아니라 기존 데이터를 먼저 불러온 후 수정사항을 바탕으로 update 요청을 보내야하기 때문이다. 다시 요청을 보내는 건 create와 유사하게 처리하면 될 거 같은데, 어떻게 기존 게시글 데이터를 가져올 것인가를 고민하다가 해당 게시글의 고유 id 값이 있다는 걸 기억해서 그 id를 params로 담아 가져올 수 있게 하였다. 방법 자체를 생각하고 난 후엔 고민했던 시간에 비하면 비교적 수월하게 기능을 성공적으로 구현할 수 있었다.

### iframe CORS

`DOMException : Blocked a frame with origin "도메인" from accessing a cross-origin `
팝업 창과 부모 창 간의 origin 즉, 도메인이 다른 상황에서 DOM 접근시 발생한다. 팝업 창이나, iframe을 사용할 때 서로 도메인이 다르거나 프로토콜이 다른 경우, 서로 다른 도메인에서 스크립트 처리시 보안 정책 위반으로 오류가 발생한다.

OAuth로 회원가입 및 로그인을 할 수 있도록 구현돼 있다. 해당 요청이 있을 시 팝업이 생성되는데 이때 콘솔에 CORS 에러가 출력된다.
알아본 바로는 다른 origin을 가진 iframe DOM 트리에 접근하는 경우라 원칙적으로 에러 로그가 뜨는 게 맞다. 다만 이 경우는 OAuth를 이용할 뿐 DOM을 조작하려는 것은 아니기 때문에 콘솔에 에러가 뜨는 것을 제외하면 따로 문제되는 것은 없다. 따라서 해결 후순위로 미뤄두었다. 팝업 방식 대신 redirect로 로그인하게 하면 해당 에러는 발생하지 않지만 사용자 편의상 팝업이 더 좋다고 판단해서 그대로 남겨두었다.

## 시간 등의 제약으로 아직 구현하지 못한 것들

- 좋아요 요청 시 Optimistic UI 적용
